# Booking service backend

## –ó–∞–ø—É—Å–∫

**–ß–µ—Ä–µ–∑ –∑–∞–¥–∞—á–∏:**
- 0:üêãüëç CONTAINER :: UP *- –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ë–î –∏ SEQ*
- 1:üêãüëç CONTAINER :: UP FULL *- –∑–∞–ø—É—Å–∫–∞–µ—Ç –ë–î, SEQ –∏ —Å–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ*
- 2:üêãüëç CONTAINER :: FULL UP WITH BUILD *- –ø–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–æ–π*

**–ß–µ—Ä–µ–∑ Powershell:**
```powershell

# –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ë–î –∏ SEQ
docker compose up -d

# –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–æ–π
docker compose --profile full up -d --build

```

## –õ–æ–≥–∏

SEQ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ http://localhost:8088/

***SEQ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–∞–∫ —á—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.***

**CorrelationId**
- –∫–æ–ø–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ headers –æ—Ç–≤–µ—Ç–∞ `X-Correlation-Id`
- –≤ –ø–æ–∏—Å–∫–µ SEQ —É–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ª–æ–≤–∏–µ `CorrelationId = 'b5a9d269-bda9-408d-bf44-52f50e9e12f3'`

---
### –ï—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ç–∞—Å–∫–∏ (tasks.json –∏ –¥–ª—è rider)

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —á–µ—Ä–µ–∑ Terminal -> Run Task –∏–ª–∏ F1 -> Run Task.

–ù–æ –µ—Å—Ç—å –∏ –æ—á–µ–Ω—å —É–¥–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –º–æ–∂–Ω–æ –æ–±–∞ —Å—Ç–∞–≤–∏—Ç—å.
- https://marketplace.visualstudio.com/items?itemName=cnshenj.vscode-task-manager
- https://marketplace.visualstudio.com/items?itemName=spmeesseman.vscode-taskexplorer

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ö–æ—Ä–Ω–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å
```
BookingService/
‚îú‚îÄ‚îÄ _common/          # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ _docker/          # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ compose.yaml  # –û—Å–Ω–æ–≤–Ω–æ–π docker-compose —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ NewDomain/        # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ Root.api/         # –ö–æ—Ä–Ω–µ–≤–æ–π API –ø—Ä–æ–µ–∫—Ç
```

## –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤

### 1. –ü—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è –ø–∞–ø–æ–∫
- `_common` - –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Å underscore –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- `_docker` - –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã
- –ë–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–æ–º–µ–Ω—ã

### 2. –°—Ö–µ–º–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –¥–æ–º–µ–Ω–∞
```
{Domain}.{Layer}[.{Specific}]
```

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞:**
```
NewDomain.api          # API —Å–ª–æ–π
NewDomain.app          # –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π —Å–ª–æ–π
NewDomain.bridge       # –ú–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–æ –≤—Å–µ—Ö 3—Ö —Å–ª–æ—è—Ö(–∞–ø–∏, –±–∏–∑–Ω–µ—Å, –±–¥)
NewDomain.dal          # Data Access Layer
NewDomain.domain       # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
NewDomain.job          # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
NewDomain.shared       # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
NewDomain.shared.impl  # –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```

### 3. –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **`.api`** - Web API, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
- **`.app`** - Use Cases, Application Services
- **`.domain`** - Domain Models, Business Logic
- **`.dal`** - Data Access, Repository implementations
- **`.shared`** - Shared Kernel, Common abstractions
- **`.job`** - Background Jobs, Workers
- **`.bridge`** - Shared models
## DDD-–º–æ–¥—É–ª—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–æ—â–∞–¥–æ–∫

–î–æ–±–∞–≤–ª–µ–Ω –±–∞–∑–æ–≤—ã–π –º–æ–¥—É–ª—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å—Ç–∏–ª–µ DDD:
- `Booking.domain` ‚Äî –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤.
- `Booking.app` ‚Äî application-—Å–µ—Ä–≤–∏—Å—ã –∏ in-memory —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
- `Booking.bridge` ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã API.

### –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `GET /api/booking/fields` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫.
- `GET /api/booking/fields/{fieldId}/slots?date=2026-01-10` ‚Äî —Å–≤–æ–±–æ–¥–Ω—ã–µ –ø–æ—á–∞—Å–æ–≤—ã–µ —Å–ª–æ—Ç—ã (UTC).
- `POST /api/booking/bookings` ‚Äî —Å–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.

–ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "fieldId": "0d417b4a-c3c1-4ba3-a60d-9102d7b52f1a",
  "startUtc": "2026-01-10T10:00:00Z",
  "hours": 2,
  "customerName": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"
}
```

–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª —É–∂–µ –∑–∞–Ω—è—Ç, —Å–µ—Ä–≤–∏—Å –≤–µ—Ä–Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è.

## –†–∞–∑–±–æ—Ä –¥–æ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (DDD)

–ù–∏–∂–µ —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ –≤ –º–æ–¥—É–ª–µ `Booking` —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è DDD.

### Value Object

- `TimeRange` (`Booking.domain/TimeRange.cs`) ‚Äî **Value Object**.
  - –ù–µ –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏.
  - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ `StartUtc` –∏ `EndUtc`.
  - –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ (UTC –∏ `End > Start`) –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ `Overlaps`.

### Entity

- `SportsField` (`Booking.domain/SportsField.cs`) ‚Äî **Entity**.
  - –ò–º–µ–µ—Ç —É—Å—Ç–æ–π—á–∏–≤—É—é –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å `Id`.
  - –°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–ø—É—Å—Ç–∏–º–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å `SupportsDuration`).

- `FieldBooking` (`Booking.domain/FieldBooking.cs`) ‚Äî **Entity**.
  - –ò–º–µ–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å `Id`.
  - –ü—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –ø–æ–ª—é —á–µ—Ä–µ–∑ `FieldId`.
  - –í–∫–ª—é—á–∞–µ—Ç `TimeRange` –∫–∞–∫ value object –∏ —É–º–µ–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç `ConflictsWith`.

### Aggregate –∏ Aggregate Root

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ç:

- **Aggregate Root: `SportsField`**
- **–í–Ω—É—Ç—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ç–∞: –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ –ø–æ–ª—è (`FieldBooking`)**

–ò–¥–µ—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞ –∞–≥—Ä–µ–≥–∞—Ç–∞: –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏—Ö—Å—è –±—Ä–æ–Ω–µ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

–°–µ–π—á–∞—Å –ø—Ä–æ–≤–µ—Ä–∫–∞ —ç—Ç–æ–≥–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ `BookingDomainService.HasConflicts(...)`, –∞ —Å–∞–º–∏ –±—Ä–æ–Ω–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –≠—Ç–æ —Ä–∞–±–æ—á–∏–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞, –Ω–æ –≤ ¬´—á–∏—Å—Ç–æ–º¬ª DDD –æ–±—ã—á–Ω–æ:

1. –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ aggregate root,
2. –∫–æ—Ä–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ç–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –Ω–∞–±–æ—Ä–∞ –±—Ä–æ–Ω–µ–π,
3. —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç/–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç –∫–∞–∫ –µ–¥–∏–Ω–∏—Ü—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏.

### Domain Service

- `BookingDomainService` ‚Äî **Domain Service**,
  - –ø–æ—Ç–æ–º—É —á—Ç–æ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏,
  - –Ω–æ –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –æ–¥–Ω–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –≤ —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ.

–ò—Ç–æ–≥–æ –ø–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:

- **Value Object:** `TimeRange`
- **Entities:** `SportsField`, `FieldBooking`
- **Aggregate Root (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –º–æ–¥–µ–ª—å):** `SportsField`
- **Domain Service:** `BookingDomainService`
